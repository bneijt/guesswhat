<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="content-type" />


<title>Guess what</title>
<link rel="stylesheet" href="base.css" type="text/css" media="screen" />
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script>//<![CDATA[
function register() {
    var name = $("#name").val();
    var number = $("#number").val();
    //TODO This will fail when name or number contains a special value (like "/")
	$.getJSON("guesswhat/set/" + name + "/" + number,
	        function(data){
	            $("#registerForm").hide();
              reloadPeople();
	});
    return false;
 }
function reloadPeople(){
	//Load the poeple list
    $("#people").load("guesswhat/people/list", function(){
        //Link up the elements to the guess handler
        $(".guessfield").change(function(){guess(this);});
        });
}
function guess(personfieldObject) {
    //TODO This will fail when name or number contains a special value (like "/")
    var personfield = $(personfieldObject);
    var number = personfield.val();
    var name = personfield.prev().text();
    $.getJSON("guesswhat/guess/" + name + "/" + number,
            function(item){
                if(item[0] == true)
                    personfield.removeClass('red').addClass('green');
                else
                    personfield.removeClass('green').addClass('red');
                //$("<img/>").attr("src", item.media.m).appendTo("#images");
              });
 
}
$(document).ready( function(){
  //TODO register timed reloader
    reloadPeople();
});
//]]></script>
</head>

<body>
<div class="page">
<h1 class="center">Guess what...</h1>

<div class="center">
<form action="" onsubmit="return register()" id="registerForm">
<p>Your name: <input type="text" id="name"></input></p>
<p>Your number: <input type="text" id="number"></input></p>
<p><input type="submit"></input></p>
</form>
<div id="people" />

</div>
</div>

</body>
</html>
